machine:
  timezone: Asia/Tokyo
  ruby:
    version: 2.3.1
  node:
    version: 4.6.0

  post:
    - curl -o- -L https://yarnpkg.com/install.sh | bash

dependencies:
  cache_directories:
    - "~/.yarn-cache"
    - "vendor/bundle"

  pre:
    - mv config/secrets.ci.yml config/secrets.yml
    - yarn --version
    - bundle install

  override:
    - yarn install
    - bundle -j4 --path=vendor/bundle

test:
  post:
    - bash <(curl -s https://codecov.io/bash)

deployment:
  deploy:
    branch: master
    commands:
      - sh ./script/production_deploy.sh
      - bundle exec cap production deploy:
          timeout: 1200
